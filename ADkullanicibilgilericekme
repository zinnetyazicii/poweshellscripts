Add-Type -AssemblyName System.Windows.Forms
Add-Type -AssemblyName System.Drawing

# Form TasarÄ±mÄ±
$Form = New-Object System.Windows.Forms.Form
$Form.Text = "Active Directory KullanÄ±cÄ± Bilgisi"
$Form.Size = New-Object System.Drawing.Size(500, 550)
$Form.StartPosition = "CenterScreen"
$Form.BackColor = [System.Drawing.Color]::FromArgb(240, 240, 240)

# KullanÄ±cÄ± AdÄ± Etiketi
$Label = New-Object System.Windows.Forms.Label
$Label.Text = "KullanÄ±cÄ± AdÄ±:"
$Label.Location = New-Object System.Drawing.Point(20, 20)
$Label.AutoSize = $true
$Form.Controls.Add($Label)

# KullanÄ±cÄ± AdÄ± Ä°Ã§in TextBox
$TextBox = New-Object System.Windows.Forms.TextBox
$TextBox.Location = New-Object System.Drawing.Point(120, 18)
$TextBox.Width = 200
$Form.Controls.Add($TextBox)

# KullanÄ±cÄ± FotoÄŸrafÄ±
$PictureBox = New-Object System.Windows.Forms.PictureBox
$PictureBox.Location = New-Object System.Drawing.Point(350, 20)
$PictureBox.Size = New-Object System.Drawing.Size(100, 100)
$PictureBox.BorderStyle = "FixedSingle"
$PictureBox.SizeMode = "StretchImage"
$Form.Controls.Add($PictureBox)

# KullanÄ±cÄ± Bilgilerini GÃ¶steren ListBox
$ListBox = New-Object System.Windows.Forms.ListBox
$ListBox.Location = New-Object System.Drawing.Point(20, 130)
$ListBox.Size = New-Object System.Drawing.Size(450, 300)
$ListBox.SelectionMode = "MultiExtended"
$ListBox.ContextMenuStrip = New-Object System.Windows.Forms.ContextMenuStrip
$CopyMenuItem = New-Object System.Windows.Forms.ToolStripMenuItem
$CopyMenuItem.Text = "Kopyala"
$CopyMenuItem.Add_Click({
    $SelectedItems = $ListBox.SelectedItems | ForEach-Object { $_ }
    if ($SelectedItems) {
        [System.Windows.Forms.Clipboard]::SetText($SelectedItems -join "`r`n")
    }
})
$ListBox.ContextMenuStrip.Items.Add($CopyMenuItem)
$Form.Controls.Add($ListBox)

# Bilgileri Getir Butonu
$Button = New-Object System.Windows.Forms.Button
$Button.Text = "Sorgula"
$Button.Location = New-Object System.Drawing.Point(120, 50)
$Button.BackColor = [System.Drawing.Color]::FromArgb(50, 150, 250)
$Button.ForeColor = [System.Drawing.Color]::White
$Button.Font = New-Object System.Drawing.Font("Arial", 10, [System.Drawing.FontStyle]::Bold)

$Button.Add_Click({
    $Username = $TextBox.Text
    if ($Username -ne "") {
        Try {
            # Active Directory'den KullanÄ±cÄ± Bilgilerini Ã‡ek
            $User = Get-ADUser -Identity $Username -Properties *

            # Listeyi Temizle
            $ListBox.Items.Clear()
            
            # KullanÄ±cÄ± Bilgilerini Listeye Ekle (Ä°konlarla)
            $ListBox.Items.Add("ğŸ‘¤ AdÄ± SoyadÄ±: $($User.DisplayName)")
            $ListBox.Items.Add("ğŸ“§ E-Posta: $($User.Mail)")
            $ListBox.Items.Add("ğŸ“ Telefon: $($User.TelephoneNumber)")
            $ListBox.Items.Add("ğŸ¢ Departman: $($User.Department)")
            $ListBox.Items.Add("ğŸ”‘ Oturum AÃ§ma AdÄ±: $($User.SamAccountName)")
            $ListBox.Items.Add("â° Son GiriÅŸ Tarihi: $($User.LastLogonDate)")
            $ListBox.Items.Add("âœ… Hesap Durumu: $(if($User.Enabled){"Aktif"}else{"Devre DÄ±ÅŸÄ±"})")
            
            # Parola Bilgileri
            $PasswordNeverExpires = if ($User.PasswordNeverExpires) { "Evet" } else { "HayÄ±r" }
            $PwdLastSet = $User.PasswordLastSet
            if ($PwdLastSet) {
                $MaxPasswordAge = (Get-ADDefaultDomainPasswordPolicy).MaxPasswordAge.Days
                $DaysUntilPasswordExpires = $MaxPasswordAge - (New-TimeSpan -Start $PwdLastSet -End (Get-Date)).Days
                $ListBox.Items.Add("â³ Parola DeÄŸiÅŸtirme Kalan GÃ¼n: $DaysUntilPasswordExpires")
            }
            $ListBox.Items.Add("ğŸ”’ Parola SÃ¼resiz mi?: $PasswordNeverExpires")
            
            # Hesap SÃ¼re Sonu Bilgisi
            $AccountExpires = $User.AccountExpires
            if ($AccountExpires -eq 0 -or $AccountExpires -eq 9223372036854775807) {
                $ListBox.Items.Add("â²ï¸ Hesap SÃ¼re Sona Erme ZamanÄ±: Sona Ermez :)")
            } else {
                $ExpireDate = [DateTime]::FromFileTime($AccountExpires)
                $ListBox.Items.Add("â²ï¸ Hesap SÃ¼re Sona Erme ZamanÄ±: Sona Erer:( , $ExpireDate")
            }
            
            # Manager Bilgisi
            if ($User.Manager) {
                $Manager = Get-ADUser -Identity $User.Manager -Properties DisplayName
                $ListBox.Items.Add("ğŸ‘¥ YÃ¶neticisi: $($Manager.DisplayName)")
            }
            
            # OU Bilgisi (En alta)
            $ListBox.Items.Add("ğŸ“‚ OU Bilgisi: $($User.DistinguishedName)")
            
            # Grup Ãœyelikleri (En alta)
            $Groups = Get-ADUser -Identity $Username -Properties MemberOf | Select-Object SiaObject -ExpandProperty MemberOf
            if ($Groups) {
                $ListBox.Items.Add("ğŸ‘¥ Grup Ãœyelikleri:")
                $Groups | ForEach-Object { $ListBox.Items.Add(" - $_") }
            }
            
            # KullanÄ±cÄ± FotoÄŸrafÄ±
            if ($User.thumbnailPhoto -ne $null) {
                $ImageData = [System.Drawing.Image]::FromStream([System.IO.MemoryStream]::new($User.thumbnailPhoto))
                $PictureBox.Image = $ImageData
            } else {
                $PictureBox.Image = $null
            }

        } Catch {
            [System.Windows.Forms.MessageBox]::Show("KullanÄ±cÄ± bulunamadÄ±!", "Hata", "OK", "Error")
        }
    } else {
        [System.Windows.Forms.MessageBox]::Show("LÃ¼tfen bir kullanÄ±cÄ± adÄ± girin!", "UyarÄ±", "OK", "Warning")
    }
})
$Form.Controls.Add($Button)

# SÃ¼rÃ¼m ve Web Sitesi Bilgisi
$VersionLabel = New-Object System.Windows.Forms.Label
$VersionLabel.Text = "www.emrahtolu.com | SÃ¼rÃ¼m 1.0 | GÃ¼ncellenme: 2025-04-02"
$VersionLabel.Location = New-Object System.Drawing.Point(20, 450)
$VersionLabel.AutoSize = $true
$VersionLabel.ForeColor = [System.Drawing.Color]::Gray
$Form.Controls.Add($VersionLabel)

# Formu GÃ¶ster
$Form.ShowDialog()
